<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Family Tree</title>
  <style>
    body {
      font-family: "Helvetica Neue", sans-serif;
      margin: 20px;
      text-align: center;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    #tree {
      display: flex;
      justify-content: center;
      margin-top: 40px;
      flex-direction: column;
      align-items: center;
    }

    .person {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin: 10px;
      display: inline-block;
      background-color: #f9f9f9;
      min-width: 100px;
    }

    .relationship {
      margin: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .horizontal-line {
      width: 40px;
      height: 2px;
      background-color: #000;
      margin: 0 5px;
    }

    .vertical-line {
      width: 2px;
      height: 20px;
      background-color: #000;
      margin: 0 auto;
    }

    .tree-row {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }

    .download {
      margin-top: 20px;
    }

    button {
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>Family Tree</h1>
  <p>This version does not have user login. Please take a screenshot or download your tree before leaving this page.</p>

  <div id="tree">
    <div id="root" class="person">You</div>
    <div id="partnerRow" class="tree-row"></div>
    <div id="parentRow" class="tree-row"></div>
    <div id="childRow" class="tree-row"></div>
  </div>

  <div>
    <button onclick="addMember('parent')">Add Parent</button>
    <button onclick="addMember('partner')">Add Partner</button>
    <button onclick="addMember('child')">Add Child</button>
    <button onclick="resetTree()">Reset</button>
  </div>

  <div class="download">
    <button onclick="downloadTree()">Download Tree (Image)</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let parentCount = 0;
    let partnerCount = 0;
    let childCount = 0;

    function addMember(type) {
      const tree = document.getElementById("tree");

      if (type === "parent") {
        parentCount++;
        const parentRow = document.getElementById("parentRow");

        const parentDiv = document.createElement("div");
        parentDiv.className = "person";
        parentDiv.innerText = `Parent ${parentCount}`;

        parentRow.appendChild(parentDiv);

      } else if (type === "partner") {
        if (partnerCount >= 1) {
          alert("Only one partner allowed in this demo.");
          return;
        }
        partnerCount++;
        const partnerRow = document.getElementById("partnerRow");

        const root = document.getElementById("root");
        const partnerDiv = document.createElement("div");
        partnerDiv.className = "person";
        partnerDiv.innerText = `Partner`;

        const relationshipDiv = document.createElement("div");
        relationshipDiv.className = "relationship";

        const left = document.createElement("div");
        left.appendChild(root.cloneNode(true));

        const line = document.createElement("div");
        line.className = "horizontal-line";

        relationshipDiv.appendChild(root);
        relationshipDiv.appendChild(line);
        relationshipDiv.appendChild(partnerDiv);

        partnerRow.innerHTML = ""; // Clear any existing partner
        partnerRow.appendChild(relationshipDiv);

      } else if (type === "child") {
        childCount++;
        const childRow = document.getElementById("childRow");

        const childDiv = document.createElement("div");
        childDiv.className = "person";
        childDiv.innerText = `Child ${childCount}`;

        const connector = document.createElement("div");
        connector.className = "vertical-line";

        childRow.appendChild(connector);
        childRow.appendChild(childDiv);
      }
    }

    function resetTree() {
      parentCount = 0;
      partnerCount = 0;
      childCount = 0;

      document.getElementById("partnerRow").innerHTML = "";
      document.getElementById("parentRow").innerHTML = "";
      document.getElementById("childRow").innerHTML = "";

      const root = document.getElementById("root");
      root.innerText = "You";
      document.getElementById("tree").prepend(root);
    }

    function downloadTree() {
      html2canvas(document.querySelector("#tree")).then(canvas => {
        const link = document.createElement("a");
        link.download = 'family_tree.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }
  </script>
</body>
</html>
