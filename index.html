<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Family Tree</title>
  <style>
    body {
      font-family: 'Helvetica Neue', sans-serif;
      text-align: center;
      margin: 20px;
      background: #f7f7f7;
    }

    h1 {
      margin-bottom: 5px;
    }

    p {
      margin-top: 0;
      color: gray;
    }

    .tree-container {
      display: flex;
      justify-content: center;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .person {
      border: 2px solid #333;
      border-radius: 10px;
      padding: 10px;
      margin: 10px;
      background: white;
      min-width: 120px;
      position: relative;
    }

    .connector {
      width: 2px;
      height: 30px;
      background: #333;
      margin: 0 auto;
    }

    .child-line {
      width: 60px;
      height: 2px;
      background: #333;
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .family-actions {
      margin-top: 30px;
    }

    select, button {
      padding: 10px;
      margin: 5px;
      font-family: 'Helvetica Neue', sans-serif;
    }

    .tree {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .row {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Family Tree</h1>
  <p>Note: There's no login. Make sure to save/export your tree before leaving.</p>

  <div class="family-actions">
    <input type="text" id="member-name" placeholder="Enter name" />
    <select id="relation">
      <option value="parent">Add Parent</option>
      <option value="partner">Add Partner</option>
      <option value="child">Add Child</option>
    </select>
    <button onclick="addMember()">Add</button>
    <button onclick="downloadCSV()">Download CSV</button>
    <button onclick="resetTree()">Reset</button>
  </div>

  <div class="tree" id="family-tree">
    <!-- Tree will be dynamically created here -->
  </div>

  <script>
    let family = {
      id: 0,
      name: 'You',
      parents: [],
      partner: null,
      children: []
    };

    function renderTree() {
      const container = document.getElementById('family-tree');
      container.innerHTML = '';

      // Parents
      if (family.parents.length > 0) {
        const parentRow = document.createElement('div');
        parentRow.className = 'row';
        family.parents.forEach(p => {
          parentRow.appendChild(createPersonNode(p));
        });
        container.appendChild(parentRow);
      }

      // You + Partner
      const midRow = document.createElement('div');
      midRow.className = 'row';
      midRow.appendChild(createPersonNode(family));

      if (family.partner) {
        midRow.appendChild(createPersonNode(family.partner));
      }
      container.appendChild(midRow);

      // Children
      if (family.children.length > 0) {
        const childRow = document.createElement('div');
        childRow.className = 'row';
        family.children.forEach(c => {
          childRow.appendChild(createPersonNode(c));
        });
        container.appendChild(childRow);
      }
    }

    function createPersonNode(person) {
      const div = document.createElement('div');
      div.className = 'person';
      div.textContent = person.name;
      return div;
    }

    function addMember() {
      const name = document.getElementById('member-name').value.trim();
      const relation = document.getElementById('relation').value;

      if (!name) return alert("Enter a name first!");

      const newMember = {
        id: Date.now(),
        name,
        parents: [],
        partner: null,
        children: []
      };

      switch (relation) {
        case 'parent':
          family.parents.push(newMember);
          break;
        case 'partner':
          family.partner = newMember;
          break;
        case 'child':
          family.children.push(newMember);
          break;
      }

      document.getElementById('member-name').value = '';
      renderTree();
    }

    function downloadCSV() {
      let csv = "Name,Relation\n";
      csv += `${family.name},You\n`;
      family.parents.forEach(p => csv += `${p.name},Parent\n`);
      if (family.partner) csv += `${family.partner.name},Partner\n`;
      family.children.forEach(c => csv += `${c.name},Child\n`);

      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "family_tree.csv";
      a.click();
    }

    function resetTree() {
      if (confirm("Are you sure you want to reset the tree?")) {
        family = {
          id: 0,
          name: 'You',
          parents: [],
          partner: null,
          children: []
        };
        renderTree();
      }
    }

    renderTree();
  </script>

</body>
</html>
